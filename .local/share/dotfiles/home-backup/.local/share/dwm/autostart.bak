#!/bin/bash
# save logs here:
LOG="$HOME/.local/share/dwm/dwm_autostart.log"
ERR="$HOME/.local/share/dwm/dwm_autostart.errors.log"
rm -f "$LOG"
touch "$LOG"
rm -f "$ERR"
touch "$ERR"

#log() {
    #echo "$@" >>"$LOG"
    #eval "$@" >>"$LOG" 2>>"$ERR"
#}

#start() {
    #pidof "$1" >/dev/null 2>&1 && return
    #log "$@" &
#}

exec 1> >(tee "$HOME/.local/share/dwm/dwm_autostart.log")
exec 2> >(tee "$HOME/.local/share/dwm/dwm_autostart.errors.log" >&2)

export PATH="$PATH:/home/fewcm/.local/bin"
export PATH="$PATH:/home/fewcm/.local/bin/dwm"


if test -z "$DBUS_SESSION_BUS_ADDRESS"; then
	eval `dbus-launch --sh-syntax --exit-with-x11`
	echo "D-Bus per-session daemon address is: $DBUS_SESSION_BUS_ADDRESS"
fi

systemctl --user import-environment DISPLAY XAUTHORITY

 if command -v dbus-update-activation-environment >/dev/null 2>&1; then
      dbus-update-activation-environment DISPLAY XAUTHORITY
 fi
 
# Kill already running process
_ps=(compton picom dunst wired )
for _prs in "${_ps[@]}"; do
    if [[ $(pidof ${_prs}) ]]; then
        killall -9 ${_prs}
    fi
done

/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &
eval $(gnome-keyring-daemon --start --components=pkcs11,secrets)
export $(gnome-keyring-daemon --start --components=pkcs11,secrets)
export GNOME_KEYRING_CONTROL
export GNOME_KEYRING_PID

pactl set-default-sink alsa_output.pci-0000_01_00.1.hdmi-stereo-extra1 &
#xrandr --output HDMI-0 --primary --mode 2560x1080 --pos 0x0 --rotate normal --output DVI-D-0 --mode 1920x1080 --pos 2560x0 --rotate normal &
 
playerctld daemon &

# Lauch notification daemon
#start dunst -c $HOME/.config/dunst/dunstrc &
wired -r &
greenclip daemon &

xset -dpms &
ibus-daemon -drxR

# Start dwm scripts
dwmremaps &
dwmcomp &
iindicator-sound-switcher &
unclutter &
# Restore wallpaper
setbg 
dwmbar & 
xrdb ~/.Xresources
#exec dbus-launch dwm
